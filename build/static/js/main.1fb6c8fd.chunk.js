(this["webpackJsonpcrime-maps"]=this["webpackJsonpcrime-maps"]||[]).push([[0],{102:function(e,t,n){e.exports=n(131)},130:function(e,t,n){},131:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(13),o=n.n(c),i=n(64),s=n(28),l=n(19),u=n(179),d=n(41),m=n(161),g=n(176),p=n(177),f=n(178),b=n(180),E=n(31),O=n(181),C=n(81),h=n.n(C),v=n(16),y=n(155),j=n(82),x=n.n(j),N=n(83),k=n.n(N),I={novosibirsk:{backgroundImage:"url(".concat(x.a,")"),backgroundSize:"cover",backgroundRepeat:"no-repeat"},krasnoyarsk:{backgroundImage:"url(".concat(k.a,")"),backgroundSize:"cover",backgroundRepeat:"no-repeat"}},S=Object(y.a)((function(e){return Object(v.a)({},I,{root:{width:360,flexShrink:0},rootPaper:{width:360},header:{position:"relative",height:200},searchContainer:{display:"flex",justifyContent:"space-between",margin:e.spacing(3),padding:"5px 10px",backgroundColor:"#fff",borderRadius:2*e.shape.borderRadius,border:"1px solid #ccc"},search:{width:"86%"},darkBG:{paddingTop:1,height:"100%",backgroundColor:"rgba(0, 0, 0, .5)"}})})),T=n(56),w=n.n(T),_=n(50),L=n(158),z=n(160),R=n(44),M=Object(y.a)((function(e){return Object(R.a)({root:{display:"flex",alignItems:"center",overflowX:"hidden",margin:e.spacing(1)},cityName:{marginLeft:e.spacing(1),color:e.palette.text},emblemContainer:{display:"none"},grow:{flexGrow:1},changeCityButton:{color:e.palette.text}},e.breakpoints.up("md"),{root:{margin:e.spacing(3)},cityName:{color:"#fff"},emblemContainer:{display:"flex",justifyContent:"center",alignItems:"center",width:40,height:40,background:"#fff",borderRadius:"50%"},emblem:{height:30},changeCityButton:{color:"#fff"}})})),A=n(87),D=n.n(A),Z=n(88),B=n.n(Z),G={novosibirsk:D.a,krasnoyarsk:B.a};var H=function(e){var t=e.fetchCities,n=e.setModal,c=e.loading,o=e.city,i=e.titleCity,s=M();return Object(a.useEffect)((function(){c&&t()}),[c,t]),r.a.createElement("div",{className:s.root},r.a.createElement("div",{className:s.emblemContainer},r.a.createElement("img",{className:s.emblem,src:G[i],alt:""})),r.a.createElement(_.a,{variant:"h6",className:s.cityName},o),r.a.createElement("div",{className:s.grow}),r.a.createElement(L.a,{onClick:function(){return n(!0)}},r.a.createElement(z.a,{className:s.changeCityButton})))};var F=function(e){var t=e.selectedCity,n=e.loading,a=e.fetchCities,c=e.setModal,o=S();return r.a.createElement(b.a,{smDown:!0,implementation:"css"},r.a.createElement(E.a,{variant:"permanent",className:o.root,classes:{paper:o.rootPaper}},r.a.createElement("div",{className:h()(o.header,o[t.title])},r.a.createElement("div",{className:o.darkBG},r.a.createElement("div",{className:o.searchContainer},r.a.createElement("img",{src:w.a,alt:"",height:"35px"}),r.a.createElement(O.a,{className:o.search,placeholder:"\u041f\u043e\u0438\u0441\u043a \u043f\u043e Crime Maps..."})),r.a.createElement(H,{loading:n,fetchCities:a,setModal:c,titleCity:t.title,city:t.name})))))},J=n(60),P=n(185),U=n(162),Y=n(163),W=Object(y.a)((function(e){return{openButton:{position:"absolute",top:e.spacing(1),left:e.spacing(1),zIndex:1e3},root:{width:"80%",zIndex:1001},header:{display:"flex",alignItems:"center",padding:e.spacing(2),paddingRight:e.spacing(0),background:"linear-gradient(45deg, #2196F3 30%, #21CBF3 90%)"},title:{marginLeft:e.spacing(1),color:"#fff"},logo:{height:30},grow:{flexGrow:1},closeMenuButton:{color:"#fff"}}}));var X=function(e){var t=e.loading,n=e.fetchCities,c=e.setModal,o=e.selectedCity,i=W(),s=Object(a.useState)(!1),l=Object(J.a)(s,2),u=l[0],d=l[1],g=function(e){return d(e)};return r.a.createElement(b.a,{mdUp:!0,implementation:"css"},r.a.createElement(m.a,{className:i.openButton,onClick:function(){return g(!0)}},r.a.createElement(U.a,null)),r.a.createElement(P.a,{open:u,onOpen:function(){return g(!0)},onClose:function(){return g(!1)},className:i.root,classes:{paper:i.root}},r.a.createElement("div",{className:i.header},r.a.createElement("img",{src:w.a,alt:"",className:i.logo}),r.a.createElement(_.a,{variant:"h6",className:i.title},"Crime Maps"),r.a.createElement("div",{className:i.grow}),r.a.createElement(L.a,{className:i.closeMenuButton,onClick:function(){return g(!1)}},r.a.createElement(Y.a,null))),r.a.createElement(H,{loading:t,fetchCities:n,setModal:c,titleCity:o.title,city:o.name})))},$=function(){return{type:"FETCH_CITIES"}},q=function(e){return{type:"MODAL",isOpen:e}},K=function(e){return{type:"ERROR",error:e}},Q=function(e){return{type:"CHANGE_CITY",id:e}},V=function(e){return{type:"CHANGE_SELECTED_CITY",id:e}};var ee=Object(s.c)((function(e){var t=e.cities;return{selectedCityId:t.selectedCity,citiesList:t.data,loading:t.loading}}),(function(e){return Object(l.b)({fetchCities:$,setModal:q},e)}))((function(e){var t=e.fetchCities,n=e.setModal,a=e.selectedCityId,c=e.citiesList,o=e.loading,i=c.find((function(e){return e.id===a}));return r.a.createElement("nav",null,r.a.createElement(F,{selectedCity:i,loading:o,fetchCities:t,setModal:n}),r.a.createElement(X,{selectedCity:i,loading:o,fetchCities:t,setModal:n}))})),te=n(182),ne=n(183),ae=n(164),re=function(e,t){return{type:"CHANGE_COORDINATES",lat:e,lng:t}},ce=function(e){return{type:"SET_ZOOM",zoom:e}},oe=function(){return{type:"INCREMENT_ZOOM"}},ie=function(){return{type:"DECREMENT_ZOOM"}},se=n(22),le=n.n(se),ue=n(89),de=n.n(ue),me=n(90),ge=n.n(me),pe=n(91),fe=n.n(pe);function be(e){var t;switch(e){case 0:t=ge.a;break;case 1:t=fe.a;break;default:t=de.a}return new le.a.Icon({iconUrl:t,iconSize:new le.a.Point(40,60),iconAnchor:[20,60]})}var Ee=Object(s.c)((function(e){var t=e.map,n=e.geodata,a=e.incidents;return{lat:t.lat,lng:t.lng,zoom:t.zoom,geodata:n.geodata,incidents:a.data}}),(function(e){return Object(l.b)({changeCoordinates:re,changeZoom:ce},e)}))((function(e){var t=e.lat,n=e.lng,a=e.zoom,c=e.geodata,o=e.changeCoordinates,i=e.changeZoom,s=e.incidents;return r.a.createElement(te.a,{center:[t,n],zoom:a,maxZoom:17,minZoom:5,attributionControl:!0,zoomControl:!1,doubleClickZoom:!0,scrollWheelZoom:!0,dragging:!0,animate:!0,easeLinearity:.35,onDragEnd:function(e){var t=e.target.getCenter(),n=t.lat,a=t.lng;o(n,a)},onZoomEnd:function(e){return i(e.target.getZoom())}},r.a.createElement(ne.a,{url:"http://{s}.tile.osm.org/{z}/{x}/{y}.png"}),c?r.a.createElement(ae.a,{position:[c.coords.latitude,c.coords.longitude],icon:be()}):null,s.map((function(e){return r.a.createElement(ae.a,{key:e.id,position:e.coords,icon:be(e.type)})})))})),Oe=n(165),Ce=n(166),he=n(168),ve=n(170),ye=n(184),je=n(171),xe=n(172),Ne=n(174),ke=n(175),Ie=n(167),Se=n(169),Te=n(173),we=Object(y.a)((function(e){return{title:{position:"relative",backgroundColor:"#eee",borderBottom:"1px solid #cecece"},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1)},loadingText:{display:"flex",justifyContent:"center",alignItems:"center"},rotate:{animation:"$rotate 1s infinite"},"@keyframes rotate":{"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(-360deg)"}},actions:{backgroundColor:"#eee",borderTop:"1px solid #cecece"}}}));var _e=Object(s.c)((function(e){var t=e.cities;return{isOpen:t.isSelectorOpen,cities:t.data,loading:t.loading,error:t.error}}),(function(e){return Object(l.b)({setModal:q,changeCity:Q,changeCoordinates:re},e)}))((function(e){var t=Object(a.useState)(null),n=Object(J.a)(t,2),c=n[0],o=n[1],i=we(),l=e.isOpen,u=e.loading,d=e.setModal,m=e.cities,g=e.changeCity,p=e.changeCoordinates;return r.a.createElement(Oe.a,{open:l,onClose:function(){return d(!1)},maxWidth:"sm",fullWidth:!0},r.a.createElement(Ce.a,{className:i.title},"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0433\u043e\u0440\u043e\u0434",r.a.createElement(L.a,{onClick:function(){return d(!1)},className:i.closeButton},r.a.createElement(Ie.a,null))),r.a.createElement(he.a,null,u&&r.a.createElement(_.a,{variant:"h6",color:"textSecondary",className:i.loadingText},"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0441\u043f\u0438\u0441\u043a\u0430 \u0433\u043e\u0440\u043e\u0434\u043e\u0432",r.a.createElement(Se.a,{className:i.rotate})),!u&&r.a.createElement(ve.a,{component:"nav"},m.map((function(e){return r.a.createElement(ye.a,{button:!0,key:e.id,selected:e.id===c,onClick:function(){return o(e.id)}},r.a.createElement(je.a,null,e.name),e.id===c&&r.a.createElement(xe.a,null,r.a.createElement(L.a,null,r.a.createElement(Te.a,null))))})))),r.a.createElement(Ne.a,{className:i.actions},r.a.createElement(ke.a,{onClick:function(){return function(e){var t=m.find((function(t){return t.id===e}));localStorage.setItem("selectedCity",e),Object(s.b)((function(){g(e),d(!1),p(t.lat,t.lng)}))}(c)},disabled:null===c},"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044c")))})),Le=Object(y.a)((function(e){return Object(R.a)({root:{display:"flex",height:"100%"},buttonUserPosition:{position:"absolute",bottom:e.spacing(3),right:e.spacing(3),zIndex:1e3},zoomButtonsContainer:{display:"flex",flexDirection:"column",position:"absolute",top:e.spacing(1),right:e.spacing(1),zIndex:1e3},buttonZoomOut:{marginTop:e.spacing(1)}},e.breakpoints.up("md"),{zoomButtonsContainer:{top:e.spacing(3),right:e.spacing(3)},buttonZoomOut:{marginTop:e.spacing(1)}})})),ze=function(e){return{type:"FETCH_ALL_INCIDENTS",id:e}},Re=function(e){return{type:"SET_ERROR",error:e}};var Me=Object(s.c)((function(e){var t=e.geodata,n=e.map,a=e.incidents,r=e.cities;return{geodata:t.geodata,zoom:n.zoom,loading:a.isLoading,selectedCityid:r.selectedCity}}),(function(e){return Object(l.b)({changeCoordinates:re,incrementZoom:oe,decrementZoom:ie,fetchAllIncidents:ze},e)}))((function(e){var t=e.changeCoordinates,n=e.geodata,c=e.incrementZoom,o=e.decrementZoom,i=e.zoom,s=e.fetchAllIncidents,l=e.loading,u=e.selectedCityid,d=Le();return Object(a.useEffect)((function(){l&&s(u)}),[l,s,u]),r.a.createElement("div",{className:d.root},r.a.createElement(ee,null),r.a.createElement(Ee,null),r.a.createElement(_e,null),r.a.createElement(m.a,{color:"primary",size:"large",className:d.buttonUserPosition,onClick:function(){return t(n.coords.latitude,n.coords.longitude)},disabled:null===n},r.a.createElement(g.a,null)),r.a.createElement("div",{className:d.zoomButtonsContainer},r.a.createElement(m.a,{size:"large",onClick:function(){17!==i&&c()}},r.a.createElement(p.a,null)),r.a.createElement(m.a,{size:"large",className:d.buttonZoomOut,onClick:function(){5!==i&&o()}},r.a.createElement(f.a,null))))})),Ae=function(e){return{type:"SET_LOCATION",data:e}},De=function(e){return{type:"SET_LOCATION_ERROR",error:e}};var Ze=Object(s.c)(null,(function(e){return Object(l.b)({setLocation:Ae,setLocationError:De},e)}))((function(e){var t=e.setLocation,n=e.setLocationError;return navigator.geolocation.getCurrentPosition(t,n),r.a.createElement(a.Fragment,null,r.a.createElement(u.a,null),r.a.createElement(d.c,null,r.a.createElement(d.a,{exact:!0,path:"/",component:Me})))})),Be=n(93),Ge={data:JSON.parse(localStorage.getItem("citiesList"))||[{_id:"5e8f0f4f8883b725cc275bad",id:1,title:"novosibirsk",name:"\u041d\u043e\u0432\u043e\u0441\u0438\u0431\u0438\u0440\u0441\u043a",lat:55.0415,lng:82.9346}],isSelectorOpen:!1,error:!1,loading:!0,selectedCity:+localStorage.getItem("selectedCity")||1};var He,Fe,Je=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ge,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ADD":return Object(v.a)({},e,{data:t.cities});case"MODAL":return Object(v.a)({},e,{isSelectorOpen:t.isOpen});case"ERROR":return Object(v.a)({},e,{error:t.error});case"LOADING":return Object(v.a)({},e,{loading:t.loading});case"CHANGE_SELECTED_CITY":return Object(v.a)({},e,{selectedCity:t.id});default:return e}},Pe=+JSON.parse(localStorage.getItem("selectedCity")),Ue=JSON.parse(localStorage.getItem("citiesList"));if(Pe&&Ue){var Ye=Ue.find((function(e){return e.id===Pe}));He=Ye.lat,Fe=Ye.lng}else He=55.0415,Fe=82.9346;var We={lat:He,lng:Fe,zoom:13},Xe={geodata:null,error:!1},$e={isLoading:!0,data:[],error:!1},qe=Object(l.c)({cities:Je,map:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:We,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"CHANGE_COORDINATES":return Object(v.a)({},e,{lat:t.lat,lng:t.lng});case"SET_ZOOM":return Object(v.a)({},e,{zoom:t.zoom});case"INCREMENT_ZOOM":return Object(v.a)({},e,{zoom:++e.zoom});case"DECREMENT_ZOOM":return Object(v.a)({},e,{zoom:--e.zoom});default:return e}},geodata:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Xe,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_LOCATION":return Object(v.a)({},e,{geodata:t.data});case"SET_LOCATION_ERROR":return Object(v.a)({},e,{error:!0});default:return e}},incidents:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:$e,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_INCIDENTS":return Object(v.a)({},e,{data:t.incidents});case"SET_LOADING":return Object(v.a)({},e,{isLoading:!1});case"SET_ERROR":return Object(v.a)({},e,{error:t.error});default:return e}}}),Ke=n(24),Qe=n.n(Ke),Ve=n(17),et=n(59),tt=n.n(et),nt=Qe.a.mark(ct),at=Qe.a.mark(ot),rt=Qe.a.mark(it);function ct(){var e,t;return Qe.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,Object(Ve.b)(tt.a.get,"/api/cities/");case 3:return e=n.sent,t=e.data,localStorage.setItem("citiesList",JSON.stringify(t)),n.next=8,Object(Ve.c)({type:"ADD",cities:t});case 8:return n.next=10,Object(Ve.c)(K(!1));case 10:return n.next=12,Object(Ve.c)({type:"LOADING",loading:!1});case 12:n.next=19;break;case 14:return n.prev=14,n.t0=n.catch(0),console.error(n.t0.message),n.next=19,Object(Ve.c)(K(!0));case 19:case"end":return n.stop()}}),nt,null,[[0,14]])}function ot(e){var t;return Qe.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,t=e.id,n.next=4,Object(Ve.c)(ze(t));case 4:return n.next=6,Object(Ve.c)(V(t));case 6:n.next=11;break;case 8:n.prev=8,n.t0=n.catch(0),console.error(n.t0.message);case 11:case"end":return n.stop()}}),at,null,[[0,8]])}function it(){return Qe.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(Ve.e)("FETCH_CITIES",ct);case 2:return e.next=4,Object(Ve.e)("CHANGE_CITY",ot);case 4:case"end":return e.stop()}}),rt)}var st=Qe.a.mark(ut),lt=Qe.a.mark(dt);function ut(e){var t,n,a,r,c,o,i;return Qe.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return t=e.id,s.prev=1,s.next=4,Object(Ve.d)((function(e){return{cities:e.cities.data}}));case 4:return n=s.sent,a=n.cities,r=a.find((function(e){return e.id===t})),c=r.title,s.next=9,Object(Ve.b)(tt.a.get,"/api/incidents/".concat(c));case 9:return o=s.sent,i=o.data,s.next=13,Object(Ve.c)(Re(!1));case 13:return s.next=15,Object(Ve.c)({type:"SET_LOADING",value:!1});case 15:return s.next=17,Object(Ve.c)({type:"SET_INCIDENTS",incidents:i});case 17:s.next=24;break;case 19:return s.prev=19,s.t0=s.catch(1),console.error(s.t0.message),s.next=24,Object(Ve.c)(Re(!0));case 24:case"end":return s.stop()}}),st,null,[[1,19]])}function dt(){return Qe.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(Ve.e)("FETCH_ALL_INCIDENTS",ut);case 2:case"end":return e.stop()}}),lt)}var mt=Qe.a.mark(gt);function gt(){return Qe.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(Ve.a)([it(),dt()]);case 2:case"end":return e.stop()}}),mt)}var pt=gt,ft=Object(Be.a)(),bt=Object(l.e)(qe,Object(l.a)(ft));window.getState=bt.getState,ft.run(pt);var Et=bt;n(130);o.a.render(r.a.createElement(i.a,null,r.a.createElement(s.a,{store:Et},r.a.createElement(Ze,null))),document.getElementById("root"))},56:function(e,t,n){e.exports=n.p+"static/media/logo_dark.6ea33164.svg"},82:function(e,t,n){e.exports=n.p+"static/media/novosibirsk.3223fede.jpg"},83:function(e,t,n){e.exports=n.p+"static/media/krasnoyarsk.aaf9cd5c.jpg"},87:function(e,t,n){e.exports=n.p+"static/media/novosibirsk.f2328259.svg"},88:function(e,t,n){e.exports=n.p+"static/media/krasnoyarsk.0bba5569.svg"},89:function(e,t,n){e.exports=n.p+"static/media/user.ed058a81.svg"},90:function(e,t,n){e.exports=n.p+"static/media/car_theft.f15135e1.svg"},91:function(e,t,n){e.exports=n.p+"static/media/fire.4faaaf86.svg"}},[[102,1,2]]]);
//# sourceMappingURL=main.1fb6c8fd.chunk.js.map